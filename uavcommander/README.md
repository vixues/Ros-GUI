# UAV Commander

> ğŸš åŸºäº LLM çš„æ™ºèƒ½æ— äººæœºé›†ç¾¤æ§åˆ¶ Multi-Agent ç³»ç»Ÿ

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

**UAV Commander** æ˜¯ä¸€ä¸ªé¢å‘æ— äººæœºé›†ç¾¤ï¼ˆUAV Swarmï¼‰çš„æ™ºèƒ½æ§åˆ¶æ¡†æ¶ï¼Œé‡‡ç”¨ **Multi-Agent Orchestration** æ¶æ„ï¼Œå°†å¤§è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰ä¸æ— äººæœºæ§åˆ¶ç³»ç»Ÿæ·±åº¦èåˆã€‚ç³»ç»Ÿé€šè¿‡å°† Agent å·¥å…·åŒ–ï¼ˆAgent-as-Toolï¼‰ï¼Œå®ç°ä¸»ä»£ç†å¯¹å¤šä¸ªä¸“ä¸šå­ä»£ç†çš„åŠ¨æ€è°ƒåº¦ï¼Œå®Œæˆä»è‡ªç„¶è¯­è¨€æŒ‡ä»¤åˆ°æ— äººæœºè¡Œä¸ºçš„ç«¯åˆ°ç«¯è½¬æ¢ã€‚

### è®¾è®¡ç†å¿µ

æœ¬é¡¹ç›®å€Ÿé‰´äº† Google Gemini CLI çš„ Agent æ¡†æ¶è®¾è®¡æ¨¡å¼ï¼Œæ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

> **"å°†å­ä»£ç†å°è£…ä¸ºå¯æ‰§è¡Œå·¥å…·ï¼ˆInvocationï¼‰ï¼Œä½¿å…¶èƒ½è¢«å…¶ä»–ä»£ç†å®‰å…¨ã€å¯æ§ã€å¯æµå¼åœ°è°ƒç”¨"**

### æ ¸å¿ƒç‰¹æ€§

| ç‰¹æ€§ | æè¿° |
|------|------|
| ğŸ§  **Multi-Agent ç¼–æ’** | Coordinator ä¸»ä»£ç†åŠ¨æ€è°ƒåº¦å¤šä¸ª Specialist å­ä»£ç† |
| ğŸ”§ **Agent-as-Tool** | å­ä»£ç†ä½œä¸ºå·¥å…·è¢«è°ƒç”¨ï¼Œç»Ÿä¸€å·¥å…·ä¸ä»£ç†çš„æ‰§è¡Œæ¨¡å‹ |
| ğŸ“¡ **æµå¼æ´»åŠ¨è¾“å‡º** | å­ä»£ç†æ€è€ƒè¿‡ç¨‹ï¼ˆThought Chunksï¼‰å®æ—¶æµå¼ä¼ é€’è‡³ UI |
| ğŸ›¡ï¸ **å¤šçº§å®¡æ‰¹æœºåˆ¶** | å±é™©æ“ä½œéœ€äººå·¥ç¡®è®¤ï¼Œæ”¯æŒ STRICT / NORMAL / YOLO æ¨¡å¼ |
| ğŸ”„ **äº‹ä»¶é©±åŠ¨æ¶æ„** | åŸºäº EventBus çš„çŠ¶æ€å‘å¸ƒä¸è®¢é˜…æœºåˆ¶ |
| ğŸ¤– **ROS 2 åŸç”Ÿé›†æˆ** | é€šè¿‡ Topics / Services / Actions ä¸æ— äººæœºé€šä¿¡ |

---

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              UAV Commander                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                          â”‚
â”‚  â”‚   User Input   â”‚  "5æ¶æ— äººæœºç¼–é˜Ÿé£å¾€åæ ‡Aï¼Œåˆ°è¾¾åå±•å¼€åŒºåŸŸæœç´¢"              â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                          â”‚
â”‚          â”‚                                                                   â”‚
â”‚          â–¼                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                        CLI / GUI Interface                            â”‚   â”‚
â”‚  â”‚                    (RequestContext, EventBus)                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                       â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•§â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚  â•‘                         CORE AGENT SYSTEM                             â•‘   â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘   â”‚
â”‚  â•‘  â”‚                      AgentExecutor                              â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚                 Coordinator Agent                         â”‚  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚                                                           â”‚  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â€¢ ç†è§£ç”¨æˆ·æ„å›¾ (Intent Understanding)                    â”‚  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â€¢ ä»»åŠ¡åˆ†è§£ (Task Decomposition)                          â”‚  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â€¢ å­ä»£ç†è°ƒåº¦ (Subagent Dispatch)                         â”‚  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â€¢ ç»“æœèšåˆ (Result Aggregation)                          â”‚  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚                                                           â”‚  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  LLM: OpenAI / Claude / Gemini / Local                    â”‚  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚                              â”‚                                  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚              â”‚ tool_call:    â”‚ tool_call:    â”‚                  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚              â”‚ "formation"   â”‚ "search"      â”‚                  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚              â–¼               â–¼               â–¼                  â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚              SubagentInvocation Layer                   â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚                                                         â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â”‚ Formation     â”‚  â”‚ Navigation    â”‚  â”‚ Search      â”‚  â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â”‚ Agent         â”‚  â”‚ Agent         â”‚  â”‚ Agent       â”‚  â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â”‚               â”‚  â”‚               â”‚  â”‚             â”‚  â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â”‚ â€¢ é˜Ÿå½¢è®¡ç®—    â”‚  â”‚ â€¢ è·¯å¾„è§„åˆ’    â”‚  â”‚ â€¢ åŒºåŸŸåˆ’åˆ†  â”‚  â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â”‚ â€¢ æ§½ä½åˆ†é…    â”‚  â”‚ â€¢ é¿éšœå¤„ç†    â”‚  â”‚ â€¢ æœç´¢ç­–ç•¥  â”‚  â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â”‚ â€¢ åŒæ­¥æ§åˆ¶    â”‚  â”‚ â€¢ è½¨è¿¹ä¼˜åŒ–    â”‚  â”‚ â€¢ ç›®æ ‡è¯†åˆ«  â”‚  â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚          â”‚                  â”‚                 â”‚         â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚                             â”‚ tool_call                 â”‚    â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚  â•‘   â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘   â”‚
â”‚  â•‘                                   â”‚                                   â•‘   â”‚
â”‚  â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘   â”‚
â”‚  â•‘  â”‚                     CoreToolScheduler                           â”‚  â•‘   â”‚
â”‚  â•‘  â”‚                                                                 â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚ Tool        â”‚  â”‚ Tool        â”‚  â”‚ Tool        â”‚              â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚ Invocation  â”‚  â”‚ Execution   â”‚  â”‚ Result      â”‚              â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚             â”‚  â”‚             â”‚  â”‚             â”‚              â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚ â€¢ å‚æ•°æ„å»º  â”‚â†’ â”‚ â€¢ å®‰å…¨æ£€æŸ¥  â”‚â†’ â”‚ â€¢ ç»“æœå°è£…  â”‚              â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚ â€¢ Schema    â”‚  â”‚ â€¢ æ‰§è¡Œè°ƒç”¨  â”‚  â”‚ â€¢ LLMå›ä¼    â”‚              â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â”‚   éªŒè¯      â”‚  â”‚ â€¢ çŠ¶æ€æ›´æ–°  â”‚  â”‚ â€¢ é”™è¯¯å¤„ç†  â”‚              â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â•‘   â”‚
â”‚  â•‘  â”‚                                                                 â”‚  â•‘   â”‚
â”‚  â•‘  â”‚  çŠ¶æ€æµè½¬: Scheduled â†’ Executing â†’ Success / Error / Cancelled â”‚  â•‘   â”‚
â”‚  â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘   â”‚
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                      â”‚                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                          Tool Layer                                   â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚   DeviceTool    â”‚  â”‚   SwarmTool     â”‚  â”‚   SafetyGuardTool   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                     â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ arm/disarm   â”‚  â”‚  â€¢ formation    â”‚  â”‚  â€¢ geofence_check   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ takeoff      â”‚  â”‚  â€¢ disperse     â”‚  â”‚  â€¢ collision_detect â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ land         â”‚  â”‚  â€¢ follow       â”‚  â”‚  â€¢ emergency_stop   â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ goto         â”‚  â”‚  â€¢ sync_action  â”‚  â”‚  â€¢ parameter_guard  â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ velocity     â”‚  â”‚  â€¢ assign_task  â”‚  â”‚  â€¢ approval_check   â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚           â”‚                    â”‚                      â”‚              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚              â”‚                    â”‚                      â”‚                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           â”‚      ROS 2 Communication Bridge           â”‚              â”‚   â”‚
â”‚  â”‚           â”‚                                           â”‚              â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚
â”‚  â”‚  â”‚     Topics      â”‚  â”‚    Services     â”‚  â”‚     Actions       â”‚    â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚  â”‚                   â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ /uav_{id}/pose  â”‚  â”‚ /uav_{id}/arm   â”‚  â”‚ /uav_{id}/goto    â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ /uav_{id}/state â”‚  â”‚ /swarm/e_stop   â”‚  â”‚ /swarm/formation  â”‚    â”‚   â”‚
â”‚  â”‚  â”‚ /swarm/status   â”‚  â”‚ /uav_{id}/mode  â”‚  â”‚ /uav_{id}/path    â”‚    â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚
â”‚  â”‚                                                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                      â”‚                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â–¼                â–¼                â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚ UAV 1  â”‚      â”‚ UAV 2  â”‚  ...  â”‚ UAV N  â”‚
                 â”‚ (PX4)  â”‚      â”‚ (PX4)  â”‚       â”‚ (PX4)  â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
uavcommander/
â”œâ”€â”€ core/                              # æ ¸å¿ƒæ¨¡å—
â”‚   â”œâ”€â”€ agent/                         # Agent ç³»ç»Ÿ â­
â”‚   â”‚   â”œâ”€â”€ executor.py                # AgentExecutor - é©±åŠ¨ Agent è¿è¡Œä¸»å¾ªç¯
â”‚   â”‚   â”‚                              # â€¢ ç®¡ç† LLM æ¨ç† â†’ å·¥å…·è°ƒç”¨ â†’ ç»“æœå›ä¼  å¾ªç¯
â”‚   â”‚   â”‚                              # â€¢ å¤„ç†æµå¼äº‹ä»¶ (Content/ToolCall/Thought/Error)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ scheduler.py               # CoreToolScheduler - å·¥å…·è°ƒåº¦ä¸­æ¢ â­
â”‚   â”‚   â”‚                              # â€¢ å·¥å…·ç”Ÿå‘½å‘¨æœŸ: Scheduled â†’ Executing â†’ Success/Error
â”‚   â”‚   â”‚                              # â€¢ å®‰å…¨ç¡®è®¤æ§åˆ¶ (shouldConfirmExecute)
â”‚   â”‚   â”‚                              # â€¢ æ‰§è¡Œå‰åé’©å­ (executeToolWithHooks)
â”‚   â”‚   â”‚                              # â€¢ æ‰¹é‡å·¥å…·è°ƒç”¨è°ƒåº¦
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ task.py                    # Task - ä»»åŠ¡çŠ¶æ€æœºä¸äº‹ä»¶å‘å¸ƒ
â”‚   â”‚   â”‚                              # â€¢ ä»»åŠ¡çŠ¶æ€: submitted â†’ working â†’ input-required â†’ completed/failed
â”‚   â”‚   â”‚                              # â€¢ å·¥å…·è°ƒç”¨æ³¨å†Œä¸è§£æ (pendingToolCalls)
â”‚   â”‚   â”‚                              # â€¢ äº‹ä»¶å‘å¸ƒåˆ° EventBus
â”‚   â”‚   â”‚                              # â€¢ å·¥å…·ç¡®è®¤å¤„ç† (ToolConfirmationOutcome)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ invocation.py              # SubagentInvocation - å­ä»£ç†æ‰§è¡Œå®¹å™¨ â­
â”‚   â”‚   â”‚                              # â€¢ å°† AgentDefinition å°è£…ä¸ºå¯è°ƒç”¨å·¥å…·
â”‚   â”‚   â”‚                              # â€¢ åˆå§‹åŒ–å¹¶è¿è¡Œ AgentExecutor
â”‚   â”‚   â”‚                              # â€¢ æµå¼ä¼ é€’å­ä»£ç†æ´»åŠ¨ (onActivity â†’ THOUGHT_CHUNK)
â”‚   â”‚   â”‚                              # â€¢ ç»Ÿä¸€å°è£…è¿”å› ToolResult
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ context.py                 # Context - ä¸Šä¸‹æ–‡ç®¡ç†
â”‚   â”‚   â”‚                              # â€¢ å¯¹è¯å†å²ç»´æŠ¤
â”‚   â”‚   â”‚                              # â€¢ ä¸Šä¸‹æ–‡å‹ç¼© (ChatCompressed)
â”‚   â”‚   â”‚                              # â€¢ å¤šä»»åŠ¡ä¸Šä¸‹æ–‡éš”ç¦»
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ registry.py                # AgentRegistry - Agent æ³¨å†Œè¡¨
â”‚   â”‚   â”‚                              # â€¢ Agent å®šä¹‰æ³¨å†Œä¸å‘ç°
â”‚   â”‚   â”‚                              # â€¢ Agent èƒ½åŠ›æè¿° (Schema)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ basellm.py                 # BaseLLM - LLM æŠ½è±¡åŸºç±»
â”‚   â”‚   â”‚                              # â€¢ å®šä¹‰ LLM æ¥å£è§„èŒƒ
â”‚   â”‚   â”‚                              # â€¢ æµå¼è¾“å‡ºæ”¯æŒ
â”‚   â”‚   â”‚                              # â€¢ æ•…éšœè½¬ç§»æœºåˆ¶
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ llm.py                     # LLM å…·ä½“å®ç°
â”‚   â”‚   â”‚                              # â€¢ OpenAI / Claude / Gemini å®¢æˆ·ç«¯
â”‚   â”‚   â”‚                              # â€¢ Function Calling / Tool Use
â”‚   â”‚   â”‚                              # â€¢ æ¶ˆæ¯å†å²ç®¡ç†
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ prompts.py                 # Prompt æ¨¡æ¿ç®¡ç†
â”‚   â”‚   â”‚                              # â€¢ System Prompt å®šä¹‰
â”‚   â”‚   â”‚                              # â€¢ å·¥å…·æè¿°ç”Ÿæˆ
â”‚   â”‚   â”‚                              # â€¢ Few-shot Examples
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ automator.py               # Automator - è‡ªä¸»æ‰§è¡Œé€»è¾‘
â”‚   â”‚                                  # â€¢ å¤šè½®å¯¹è¯è‡ªåŠ¨é©±åŠ¨
â”‚   â”‚                                  # â€¢ ä»»åŠ¡å®Œæˆåˆ¤æ–­
â”‚   â”‚
â”‚   â”œâ”€â”€ tools/                         # å·¥å…·å±‚
â”‚   â”‚   â”œâ”€â”€ tools.py                   # DeclarativeTool - å£°æ˜å¼å·¥å…·åŸºç±»
â”‚   â”‚   â”‚                              # â€¢ tool.build(args) â†’ ToolInvocation
â”‚   â”‚   â”‚                              # â€¢ ä¸‰ç±»å·¥å…·: æ™®é€š/Modification/Editor
â”‚   â”‚   â”‚                              # â€¢ Schema å®šä¹‰ (JSON Schema)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ tool_registry.py           # ToolRegistry - å·¥å…·æ³¨å†Œè¡¨
â”‚   â”‚   â”‚                              # â€¢ å·¥å…·å‘ç°ä¸æ³¨å†Œ
â”‚   â”‚   â”‚                              # â€¢ æŒ‰æœåŠ¡å™¨åˆ†ç»„ (MCP Server)
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ device_tool.py             # DeviceTool - å•æœºæ§åˆ¶å·¥å…·
â”‚   â”‚   â”‚                              # â€¢ arm/disarm, takeoff, land
â”‚   â”‚   â”‚                              # â€¢ goto, set_velocity
â”‚   â”‚   â”‚                              # â€¢ get_status, get_position
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ swarm_tool.py              # SwarmTool - é›†ç¾¤æ§åˆ¶å·¥å…·
â”‚   â”‚                                  # â€¢ form_formation, disperse
â”‚   â”‚                                  # â€¢ follow_leader, sync_action
â”‚   â”‚                                  # â€¢ assign_tasks
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                        # é…ç½®ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ settings.py                # å…¨å±€é…ç½®
â”‚   â”‚   â”œâ”€â”€ llm_config.py              # LLM é…ç½® (æ¨¡å‹/API Key/å‚æ•°)
â”‚   â”‚   â”œâ”€â”€ safety_policy.py           # å®‰å…¨ç­–ç•¥é…ç½®
â”‚   â”‚   â””â”€â”€ ros_params.py              # ROS å‚æ•°é…ç½®
â”‚   â”‚
â”‚   â””â”€â”€ schema/                        # æ•°æ®æ¨¡å¼å®šä¹‰
â”‚       â”œâ”€â”€ messages.py                # æ¶ˆæ¯ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ events.py                  # äº‹ä»¶ç±»å‹å®šä¹‰
â”‚       â”œâ”€â”€ tool_call.py               # å·¥å…·è°ƒç”¨ç›¸å…³ç±»å‹
â”‚       â””â”€â”€ task_state.py              # ä»»åŠ¡çŠ¶æ€å®šä¹‰
â”‚
â”œâ”€â”€ cli/                               # å‘½ä»¤è¡Œæ¥å£
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                        # CLI å…¥å£
â”‚   â”œâ”€â”€ repl.py                        # äº¤äº’å¼ REPL
â”‚   â””â”€â”€ commands.py                    # å‘½ä»¤å®šä¹‰
â”‚
â”œâ”€â”€ utils/                             # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ logging.py                     # æ—¥å¿—ç³»ç»Ÿ
â”‚   â”œâ”€â”€ event_bus.py                   # äº‹ä»¶æ€»çº¿
â”‚   â””â”€â”€ async_utils.py                 # å¼‚æ­¥å·¥å…·
â”‚
â”œâ”€â”€ tests/                             # æµ‹è¯•
â”œâ”€â”€ docs/                              # æ–‡æ¡£
â”œâ”€â”€ requirements.txt                   # ä¾èµ–
â””â”€â”€ README.md
```

---

## ğŸ”„ Multi-Agent è°ƒåº¦æµç¨‹

### å®Œæ•´è°ƒåº¦å¾ªç¯

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Multi-Agent Orchestration Loop                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ç”¨æˆ·è¾“å…¥: "è®©5æ¶æ— äººæœºç¼–é˜Ÿé£å¾€Aç‚¹"
         â”‚
         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Phase 1: ä¸»ä»£ç†æ€è€ƒ (Coordinator Planning)                               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘    Coordinator Agent (LLM æ¨ç†):                                          â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘    â”‚  1. ç†è§£æ„å›¾: ç¼–é˜Ÿé£è¡Œä»»åŠ¡                                       â”‚   â•‘
â•‘    â”‚  2. åˆ†æéœ€æ±‚: éœ€è¦ç¼–é˜Ÿæ§åˆ¶èƒ½åŠ›                                   â”‚   â•‘
â•‘    â”‚  3. å†³ç­–: è°ƒç”¨ formation_agent å­ä»£ç†                            â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  Output:                                                         â”‚   â•‘
â•‘    â”‚  {                                                               â”‚   â•‘
â•‘    â”‚    "tool_calls": [{                                              â”‚   â•‘
â•‘    â”‚      "name": "formation_agent",                                  â”‚   â•‘
â•‘    â”‚      "args": {                                                   â”‚   â•‘
â•‘    â”‚        "formation_type": "V_SHAPE",                              â”‚   â•‘
â•‘    â”‚        "target": {"lat": 31.2, "lon": 121.5, "alt": 50},        â”‚   â•‘
â•‘    â”‚        "uav_ids": ["uav_1", "uav_2", "uav_3", "uav_4", "uav_5"] â”‚   â•‘
â•‘    â”‚      }                                                           â”‚   â•‘
â•‘    â”‚    }]                                                            â”‚   â•‘
â•‘    â”‚  }                                                               â”‚   â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚
         â”‚ å‘ç°éœ€è¦è°ƒç”¨å­ä»£ç†
         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Phase 2: åˆ›å»º SubagentInvocation                                         â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘    CoreToolScheduler:                                                     â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘    â”‚  # æ ¹æ®å·¥å…·åæ‰¾åˆ°å¯¹åº”çš„ AgentDefinition                          â”‚   â•‘
â•‘    â”‚  agent_def = agent_registry.get("formation_agent")               â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  # åˆ›å»º SubagentInvocation å®ä¾‹                                  â”‚   â•‘
â•‘    â”‚  invocation = SubagentInvocation(                                â”‚   â•‘
â•‘    â”‚      params=tool_call.args,                                      â”‚   â•‘
â•‘    â”‚      definition=agent_def,                                       â”‚   â•‘
â•‘    â”‚      config=config                                               â”‚   â•‘
â•‘    â”‚  )                                                               â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  # æ³¨å†Œå·¥å…·è°ƒç”¨                                                   â”‚   â•‘
â•‘    â”‚  task.register_tool_call(tool_call_id, "scheduled")              â”‚   â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚
         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Phase 3: æ‰§è¡Œå­ä»£ç†                                                      â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘    invocation.execute():                                                  â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  update_output("ğŸš€ Subagent starting: formation_agent...")       â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  # åˆ›å»ºå­ä»£ç†æ‰§è¡Œå™¨                                               â”‚   â•‘
â•‘    â”‚  executor = AgentExecutor.create(                                â”‚   â•‘
â•‘    â”‚      agent_def=agent_def,                                        â”‚   â•‘
â•‘    â”‚      config=config                                               â”‚   â•‘
â•‘    â”‚  )                                                               â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  # ç»‘å®šæ´»åŠ¨å›è°ƒ - æµå¼è¾“å‡ºå­ä»£ç†æ€è€ƒè¿‡ç¨‹                          â”‚   â•‘
â•‘    â”‚  executor.on_activity = lambda event:                            â”‚   â•‘
â•‘    â”‚      if event.type == THOUGHT_CHUNK:                             â”‚   â•‘
â•‘    â”‚          update_output(f"ğŸ¤–ğŸ’­ {event.content}")                  â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  # è¿è¡Œå­ä»£ç†                                                    â”‚   â•‘
â•‘    â”‚  result = await executor.run()                                   â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  # å­ä»£ç†å†…éƒ¨å¯èƒ½ç»§ç»­è°ƒç”¨å·¥å…·                                     â”‚   â•‘
â•‘    â”‚  # Formation Agent â†’ SwarmTool.form_formation()                  â”‚   â•‘
â•‘    â”‚  # Formation Agent â†’ DeviceTool.goto() Ã— 5                       â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                           â•‘
â•‘    UI å®æ—¶æ˜¾ç¤º:                                                           â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘    â”‚  ğŸš€ Subagent starting: formation_agent...                        â”‚   â•‘
â•‘    â”‚  ğŸ¤–ğŸ’­ åˆ†æç¼–é˜Ÿéœ€æ±‚: 5æ¶æ— äººæœº Vå½¢ç¼–é˜Ÿ                             â”‚   â•‘
â•‘    â”‚  ğŸ¤–ğŸ’­ è®¡ç®—é˜Ÿå½¢å‚æ•°: ç¿¼å±•è§’åº¦ 60Â°, é—´è· 10m                        â”‚   â•‘
â•‘    â”‚  ğŸ¤–ğŸ’­ åˆ†é…æ§½ä½: UAV1â†’é¢†èˆª, UAV2/3â†’å·¦ç¿¼, UAV4/5â†’å³ç¿¼              â”‚   â•‘
â•‘    â”‚  ğŸ”§ è°ƒç”¨å·¥å…·: swarm_tool.form_formation()                        â”‚   â•‘
â•‘    â”‚  âœ… ç¼–é˜ŸæŒ‡ä»¤å·²ä¸‹å‘                                               â”‚   â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚
         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Phase 4: å­ä»£ç†è¿”å›ç»“æœ                                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘    SubagentInvocation å°è£… ToolResult:                                    â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘    â”‚  {                                                               â”‚   â•‘
â•‘    â”‚    "llm_content": [                                              â”‚   â•‘
â•‘    â”‚      {                                                           â”‚   â•‘
â•‘    â”‚        "type": "text",                                           â”‚   â•‘
â•‘    â”‚        "text": "Subagent finished. Vå½¢ç¼–é˜Ÿå·²å»ºç«‹ï¼Œ5æ¶æ— äººæœºæ­£åœ¨   â”‚   â•‘
â•‘    â”‚                 å‘ç›®æ ‡ç‚¹é£è¡Œã€‚é¢„è®¡åˆ°è¾¾æ—¶é—´: 3åˆ†é’Ÿã€‚"              â”‚   â•‘
â•‘    â”‚      }                                                           â”‚   â•‘
â•‘    â”‚    ],                                                            â”‚   â•‘
â•‘    â”‚    "return_display": "âœ… ç¼–é˜Ÿé£è¡Œä»»åŠ¡å·²å¯åŠ¨",                     â”‚   â•‘
â•‘    â”‚    "metadata": {                                                 â”‚   â•‘
â•‘    â”‚      "formation_status": "FORMED",                               â”‚   â•‘
â•‘    â”‚      "eta_seconds": 180,                                         â”‚   â•‘
â•‘    â”‚      "uav_assignments": {...}                                    â”‚   â•‘
â•‘    â”‚    }                                                             â”‚   â•‘
â•‘    â”‚  }                                                               â”‚   â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                           â•‘
â•‘    Scheduler æ›´æ–°å·¥å…·çŠ¶æ€: "executing" â†’ "success"                        â•‘
â•‘    Task è§£æå·¥å…·è°ƒç”¨: task.resolve_tool_call(tool_call_id)                â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         â”‚
         â–¼
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  Phase 5: ä¸»ä»£ç†ç»§ç»­æ¨ç†                                                  â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘    Coordinator Agent è·å¾—å­ä»£ç†ç»“æœå:                                    â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘    â”‚  # å·¥å…·ç»“æœä½œä¸ºæ–°çš„ä¸Šä¸‹æ–‡è¾“å…¥ LLM                                 â”‚   â•‘
â•‘    â”‚  llm_input = [                                                   â”‚   â•‘
â•‘    â”‚      *previous_context,                                          â”‚   â•‘
â•‘    â”‚      {"role": "tool", "content": tool_result.llm_content}       â”‚   â•‘
â•‘    â”‚  ]                                                               â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  # LLM ç»§ç»­æ¨ç†                                                   â”‚   â•‘
â•‘    â”‚  response = await llm.generate(llm_input)                        â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  # åˆ¤æ–­: æ˜¯å¦éœ€è¦è°ƒç”¨æ›´å¤šå·¥å…·? è¿˜æ˜¯ä»»åŠ¡å®Œæˆ?                       â”‚   â•‘
â•‘    â”‚  if response.has_tool_calls:                                     â”‚   â•‘
â•‘    â”‚      # å›åˆ° Phase 2                                              â”‚   â•‘
â•‘    â”‚  else:                                                           â”‚   â•‘
â•‘    â”‚      # è¿”å›æœ€ç»ˆç»“æœç»™ç”¨æˆ·                                         â”‚   â•‘
â•‘    â”‚      return response.content                                     â”‚   â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                           â•‘
â•‘    æœ€ç»ˆè¾“å‡º:                                                              â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â•‘
â•‘    â”‚  âœ… ç¼–é˜Ÿé£è¡Œä»»åŠ¡å·²å¯åŠ¨ï¼                                          â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  5æ¶æ— äººæœºå·²å»ºç«‹Vå½¢ç¼–é˜Ÿï¼Œæ­£åœ¨å‘ç›®æ ‡ç‚¹Aé£è¡Œã€‚                       â”‚   â•‘
â•‘    â”‚  â€¢ ç¼–é˜Ÿç±»å‹: Vå½¢ (ç¿¼å±•è§’60Â°, é—´è·10m)                             â”‚   â•‘
â•‘    â”‚  â€¢ é¢†èˆªæœº: UAV-1                                                 â”‚   â•‘
â•‘    â”‚  â€¢ é¢„è®¡åˆ°è¾¾æ—¶é—´: 3åˆ†é’Ÿ                                            â”‚   â•‘
â•‘    â”‚                                                                  â”‚   â•‘
â•‘    â”‚  æ‚¨å¯ä»¥éšæ—¶è¯´"æŸ¥çœ‹ç¼–é˜ŸçŠ¶æ€"æˆ–"ç´§æ€¥åœæ­¢"ã€‚                          â”‚   â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â•‘
â•‘                                                                           â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ›¡ï¸ å®‰å…¨è®¾è®¡

### å®¡æ‰¹æ¨¡å¼ (ApprovalMode)

å‚è€ƒ task.py ä¸­çš„è®¾è®¡ï¼Œç³»ç»Ÿæ”¯æŒä¸‰ç§å®¡æ‰¹æ¨¡å¼ï¼š

```python
from enum import Enum

class ApprovalMode(Enum):
    STRICT = "strict"       # æ‰€æœ‰æ“ä½œéœ€äººå·¥ç¡®è®¤
    NORMAL = "normal"       # ä»…å±é™©æ“ä½œéœ€ç¡®è®¤ (é»˜è®¤)
    YOLO = "yolo"           # è‡ªåŠ¨æ‰¹å‡†æ‰€æœ‰æ“ä½œ (ä»…é™ä»¿çœŸ)
```

### å·¥å…·ç¡®è®¤æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Tool Confirmation Flow                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         LLM è¯·æ±‚è°ƒç”¨å·¥å…·: device_tool.takeoff(altitude=50)
                              â”‚
                              â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  Scheduler: shouldConfirmExecute()?    â”‚
         â”‚                                        â”‚
         â”‚  æ£€æŸ¥:                                 â”‚
         â”‚  â€¢ å·¥å…·ç±»å‹ (Modification/Normal)      â”‚
         â”‚  â€¢ å½“å‰ ApprovalMode                   â”‚
         â”‚  â€¢ æ“ä½œé£é™©ç­‰çº§                        â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼              â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ æ— éœ€ç¡®è®¤  â”‚   â”‚ éœ€è¦ç¡®è®¤  â”‚   â”‚ è‡ªåŠ¨ç¡®è®¤  â”‚
    â”‚ (Normal  â”‚   â”‚ (STRICT  â”‚   â”‚ (YOLO    â”‚
    â”‚  å·¥å…·)   â”‚   â”‚  æˆ–å±é™©   â”‚   â”‚  æ¨¡å¼)   â”‚
    â”‚          â”‚   â”‚  æ“ä½œ)   â”‚   â”‚          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚              â”‚              â”‚
         â”‚              â–¼              â”‚
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
         â”‚   â”‚  å‘å¸ƒçŠ¶æ€æ›´æ–°:      â”‚    â”‚
         â”‚   â”‚  awaiting_approval â”‚    â”‚
         â”‚   â”‚                    â”‚    â”‚
         â”‚   â”‚  UI æ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†  â”‚    â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â”‚             â”‚               â”‚
         â”‚             â–¼               â”‚
         â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
         â”‚   â”‚   ç”¨æˆ·é€‰æ‹©:         â”‚    â”‚
         â”‚   â”‚                    â”‚    â”‚
         â”‚   â”‚   â€¢ proceed_once   â”‚    â”‚
         â”‚   â”‚   â€¢ proceed_always â”‚    â”‚
         â”‚   â”‚   â€¢ cancel         â”‚    â”‚
         â”‚   â”‚   â€¢ modify         â”‚    â”‚
         â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
         â”‚             â”‚               â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  æ‰§è¡Œå·¥å…·è°ƒç”¨   â”‚
              â”‚  æˆ–å–æ¶ˆæ“ä½œ     â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å¤šå±‚å®‰å…¨æœºåˆ¶

| å±‚çº§ | åç§° | è§¦å‘æ—¶æœº | è¡Œä¸º |
|------|------|----------|------|
| L1 | **ApprovalGuard** | å·¥å…·è°ƒç”¨å‰ | å±é™©æ“ä½œå¼¹å‡ºç¡®è®¤ |
| L2 | **ParameterGuard** | å‚æ•°éªŒè¯æ—¶ | è¾¹ç•Œæ£€æŸ¥ï¼Œæ‹’ç»éæ³•å‚æ•° |
| L3 | **GeofenceGuard** | ä½ç½®è®¡ç®—å | ç¦é£åŒºæ£€æµ‹ï¼Œè‡ªåŠ¨è§„é¿ |
| L4 | **CollisionGuard** | è½¨è¿¹è§„åˆ’æ—¶ | ç¢°æ’é¢„æµ‹ï¼Œè·¯å¾„é‡è§„åˆ’ |
| L5 | **EmergencyStop** | ä»»ä½•æ—¶åˆ» | å…¨å±€/å•æœºç´§æ€¥åœæ­¢ |

### å±é™©æ“ä½œåˆ†ç±»

```python
DANGEROUS_OPERATIONS = {
    # é«˜é£é™© - å¿…é¡»ç¡®è®¤
    "HIGH": [
        "device_tool.arm",
        "device_tool.takeoff",
        "swarm_tool.form_formation",
        "swarm_tool.disperse",
    ],
    
    # ä¸­é£é™© - NORMAL æ¨¡å¼éœ€ç¡®è®¤
    "MEDIUM": [
        "device_tool.goto",
        "device_tool.set_velocity",
        "swarm_tool.sync_action",
    ],
    
    # ä½é£é™© - ä»… STRICT æ¨¡å¼ç¡®è®¤
    "LOW": [
        "device_tool.get_status",
        "device_tool.land",  # é™è½ç›¸å¯¹å®‰å…¨
    ]
}
```

---

## ğŸ“Š ä»»åŠ¡çŠ¶æ€æœº

åŸºäº task.py å‚è€ƒå®ç°ï¼Œå®šä¹‰ä»»åŠ¡çŠ¶æ€æµè½¬ï¼š

```
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚              Task States                 â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              ä»»åŠ¡åˆ›å»º â”€â”€â”€â”€â”€â”€â†’â”‚   SUBMITTED  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â”‚ start()
                                     â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’â”‚   WORKING    â”‚â†â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
          â”‚                          â”‚                             â”‚
          â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
          â”‚         â”‚                â”‚                â”‚            â”‚
          â”‚         â–¼                â–¼                â–¼            â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
          â”‚  â”‚ LLM æ¨ç†ä¸­   â”‚  â”‚ å·¥å…·æ‰§è¡Œä¸­  â”‚  â”‚ ç­‰å¾…å·¥å…·    â”‚     â”‚
          â”‚  â”‚             â”‚  â”‚             â”‚  â”‚ å®Œæˆ        â”‚     â”‚
          â”‚  â”‚ (streaming) â”‚  â”‚ (executing) â”‚  â”‚ (pending)   â”‚     â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜     â”‚
          â”‚         â”‚                â”‚                â”‚            â”‚
          â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
          â”‚                          â”‚                             â”‚
          â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
          â”‚         â–¼                â–¼                â–¼            â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
          â”‚  â”‚ éœ€è¦æ›´å¤š    â”‚  â”‚ INPUT_REQUIRED  â”‚  â”‚ å·¥å…·è°ƒç”¨  â”‚   â”‚
          â”‚  â”‚ å·¥å…·è°ƒç”¨    â”‚  â”‚ (ç­‰å¾…äººå·¥ç¡®è®¤)  â”‚  â”‚ æˆåŠŸ      â”‚   â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜   â”‚
          â”‚         â”‚                  â”‚                 â”‚         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                       â”‚
                          ç”¨æˆ·ç¡®è®¤ / ç”¨æˆ·è¾“å…¥
                                       â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                  â–¼                  â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚  COMPLETED  â”‚   â”‚   FAILED    â”‚    â”‚  CANCELLED  â”‚
             â”‚             â”‚   â”‚             â”‚    â”‚             â”‚
             â”‚  ä»»åŠ¡æˆåŠŸ   â”‚   â”‚ ä»»åŠ¡å¤±è´¥    â”‚    â”‚ ç”¨æˆ·å–æ¶ˆ    â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### äº‹ä»¶ç±»å‹ (å‚è€ƒ CoderAgentEvent)

```python
class AgentEvent(Enum):
    # çŠ¶æ€å˜æ›´
    STATE_CHANGE = "state_change"
    
    # å†…å®¹è¾“å‡º
    TEXT_CONTENT = "text_content"
    THOUGHT = "thought"
    
    # å·¥å…·ç›¸å…³
    TOOL_CALL_UPDATE = "tool_call_update"
    TOOL_CALL_CONFIRMATION = "tool_call_confirmation"
    
    # å…¶ä»–
    CITATION = "citation"
    ERROR = "error"
```

---

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. AgentExecutor

```python
class AgentExecutor:
    """Agent æ‰§è¡Œå™¨ - é©±åŠ¨ Agent è¿è¡Œä¸»å¾ªç¯"""
    
    def __init__(self, agent_def: AgentDefinition, config: Config):
        self.agent_def = agent_def
        self.config = config
        self.llm_client = config.get_llm_client()
        self.tool_registry = config.get_tool_registry()
        self.event_callbacks: List[Callable] = []
    
    async def run(self, input_message: str) -> AgentResult:
        """
        ä¸»å¾ªç¯:
        1. å‘é€æ¶ˆæ¯ç»™ LLM
        2. å¤„ç† LLM å“åº” (å†…å®¹/å·¥å…·è°ƒç”¨/æ€è€ƒ)
        3. å¦‚æœ‰å·¥å…·è°ƒç”¨ï¼Œæ‰§è¡Œå¹¶å°†ç»“æœåé¦ˆç»™ LLM
        4. é‡å¤ç›´åˆ°ä»»åŠ¡å®Œæˆ
        """
        pass
    
    def on_activity(self, callback: Callable[[AgentActivity], None]):
        """æ³¨å†Œæ´»åŠ¨å›è°ƒï¼Œç”¨äºæµå¼è¾“å‡º"""
        self.event_callbacks.append(callback)
```

### 2. CoreToolScheduler

```python
class CoreToolScheduler:
    """å·¥å…·è°ƒåº¦å™¨ - ç®¡ç†å·¥å…·è°ƒç”¨çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ"""
    
    def __init__(
        self,
        config: Config,
        output_update_handler: Callable,
        on_tool_calls_update: Callable,
        on_all_tool_calls_complete: Callable,
    ):
        self.config = config
        self.pending_calls: Dict[str, ToolCall] = {}
        # callbacks
        self.output_update_handler = output_update_handler
        self.on_tool_calls_update = on_tool_calls_update
        self.on_all_tool_calls_complete = on_all_tool_calls_complete
    
    async def schedule(
        self,
        requests: List[ToolCallRequest],
        abort_signal: asyncio.Event
    ) -> None:
        """
        è°ƒåº¦ä¸€æ‰¹å·¥å…·è°ƒç”¨:
        1. æ„å»º ToolInvocation
        2. æ£€æŸ¥æ˜¯å¦éœ€è¦ç¡®è®¤
        3. æ‰§è¡Œå·¥å…·
        4. æ”¶é›†ç»“æœ
        """
        pass
    
    def should_confirm_execute(self, tool: DeclarativeTool, args: dict) -> bool:
        """åˆ¤æ–­æ˜¯å¦éœ€è¦äººå·¥ç¡®è®¤"""
        pass
```

### 3. SubagentInvocation

```python
class SubagentInvocation(BaseToolInvocation):
    """
    å­ä»£ç†æ‰§è¡Œå®¹å™¨
    
    æ ¸å¿ƒèŒè´£:
    - å°† AgentDefinition å°è£…ä¸ºå¯è°ƒç”¨å·¥å…·
    - åˆå§‹åŒ–å¹¶è¿è¡Œ AgentExecutor
    - æµå¼ä¼ é€’å­ä»£ç†æ´»åŠ¨
    - ç»Ÿä¸€å°è£…è¿”å› ToolResult
    """
    
    def __init__(
        self,
        params: dict,
        definition: AgentDefinition,
        config: Config
    ):
        self.params = params
        self.definition = definition
        self.config = config
    
    async def execute(
        self,
        update_output: Callable[[str], None]
    ) -> ToolResult:
        """
        æ‰§è¡Œå­ä»£ç†:
        1. è¾“å‡º "Subagent starting..."
        2. åˆ›å»º AgentExecutor
        3. ç»‘å®š onActivity å›è°ƒ
        4. è¿è¡Œå­ä»£ç†
        5. å°è£…å¹¶è¿”å› ToolResult
        """
        update_output(f"ğŸš€ Subagent starting: {self.definition.name}...")
        
        executor = AgentExecutor(self.definition, self.config)
        
        # æµå¼ä¼ é€’æ€è€ƒè¿‡ç¨‹
        executor.on_activity(lambda event: 
            update_output(f"ğŸ¤–ğŸ’­ {event.content}") 
            if event.type == "THOUGHT_CHUNK" else None
        )
        
        result = await executor.run(self.params)
        
        return ToolResult(
            llm_content=[{"type": "text", "text": f"Subagent finished. {result.summary}"}],
            return_display=result.display,
            metadata=result.metadata
        )
```

### 4. Task

```python
class Task:
    """ä»»åŠ¡ç®¡ç† - çŠ¶æ€æœºä¸äº‹ä»¶å‘å¸ƒ"""
    
    def __init__(
        self,
        task_id: str,
        context_id: str,
        config: Config,
        event_bus: EventBus
    ):
        self.id = task_id
        self.context_id = context_id
        self.config = config
        self.event_bus = event_bus
        
        self.state: TaskState = TaskState.SUBMITTED
        self.scheduler = CoreToolScheduler(...)
        self.pending_tool_calls: Dict[str, str] = {}  # callId -> status
        self.pending_confirmations: Dict[str, ToolConfirmationDetails] = {}
    
    def set_state_and_publish(
        self,
        new_state: TaskState,
        message: Optional[str] = None,
        final: bool = False
    ):
        """æ›´æ–°çŠ¶æ€å¹¶å‘å¸ƒäº‹ä»¶"""
        self.state = new_state
        self.event_bus.publish(TaskStatusUpdateEvent(
            task_id=self.id,
            state=new_state,
            message=message,
            final=final
        ))
    
    async def schedule_tool_calls(
        self,
        requests: List[ToolCallRequest],
        abort_signal: asyncio.Event
    ):
        """è°ƒåº¦å·¥å…·è°ƒç”¨"""
        self.set_state_and_publish(TaskState.WORKING)
        await self.scheduler.schedule(requests, abort_signal)
    
    async def wait_for_pending_tools(self):
        """ç­‰å¾…æ‰€æœ‰å¾…å¤„ç†å·¥å…·å®Œæˆ"""
        pass
    
    def handle_tool_confirmation(self, call_id: str, outcome: ToolConfirmationOutcome):
        """å¤„ç†ç”¨æˆ·å¯¹å·¥å…·è°ƒç”¨çš„ç¡®è®¤"""
        pass
```

---

## ğŸ”Œ ROS 2 é›†æˆ

### é€šä¿¡æ¥å£è®¾è®¡

```python
class ROSBridge:
    """ROS 2 é€šä¿¡æ¡¥æ¥å±‚"""
    
    def __init__(self, node_name: str = "uav_commander"):
        self.node = rclpy.create_node(node_name)
        self._service_clients: Dict[str, Client] = {}
        self._action_clients: Dict[str, ActionClient] = {}
        self._subscribers: Dict[str, Subscription] = {}
        self._state_cache: Dict[str, Any] = {}
    
    # === Topics (çŠ¶æ€è®¢é˜…) ===
    
    def subscribe_uav_state(self, uav_id: str, callback: Callable):
        """è®¢é˜…æ— äººæœºçŠ¶æ€"""
        topic = f"/uav_{uav_id}/state"
        self._subscribers[topic] = self.node.create_subscription(
            UAVState, topic, callback, 10
        )
    
    def get_cached_state(self, uav_id: str) -> Optional[UAVState]:
        """è·å–ç¼“å­˜çš„çŠ¶æ€"""
        return self._state_cache.get(f"uav_{uav_id}")
    
    # === Services (å³æ—¶æŒ‡ä»¤) ===
    
    async def call_arm(self, uav_id: str, arm: bool) -> ServiceResponse:
        """è§£é”/é”å®š"""
        srv_name = f"/uav_{uav_id}/arm"
        return await self._call_service(srv_name, ArmRequest(arm=arm))
    
    async def call_emergency_stop(self, uav_ids: Optional[List[str]] = None):
        """ç´§æ€¥åœæ­¢"""
        srv_name = "/swarm/emergency_stop"
        return await self._call_service(srv_name, EmergencyStopRequest(uav_ids=uav_ids))
    
    # === Actions (é•¿æ—¶ä»»åŠ¡) ===
    
    async def send_goto(
        self,
        uav_id: str,
        target: Position,
        progress_callback: Optional[Callable] = None
    ) -> ActionResult:
        """å‘é€èˆªç‚¹é£è¡Œ Action"""
        action_name = f"/uav_{uav_id}/goto"
        goal = GotoGoal(target=target)
        
        return await self._send_action_goal(
            action_name, goal,
            feedback_callback=progress_callback
        )
    
    async def send_formation(
        self,
        formation_type: str,
        uav_ids: List[str],
        target: Position,
        progress_callback: Optional[Callable] = None
    ) -> ActionResult:
        """å‘é€ç¼–é˜Ÿ Action"""
        action_name = "/swarm/formation"
        goal = FormationGoal(
            formation_type=formation_type,
            uav_ids=uav_ids,
            target=target
        )
        return await self._send_action_goal(action_name, goal, progress_callback)
```

### å·¥å…·ä¸ ROS é›†æˆç¤ºä¾‹

```python
class DeviceTool(DeclarativeTool):
    """å•æœºæ§åˆ¶å·¥å…·"""
    
    name = "device_tool"
    description = "æ§åˆ¶å•æ¶æ— äººæœºçš„åŸºæœ¬æ“ä½œ"
    
    schema = {
        "takeoff": {
            "description": "èµ·é£åˆ°æŒ‡å®šé«˜åº¦",
            "parameters": {
                "uav_id": {"type": "string", "description": "æ— äººæœºID"},
                "altitude": {"type": "number", "description": "ç›®æ ‡é«˜åº¦(ç±³)", "minimum": 1, "maximum": 120}
            },
            "required": ["uav_id", "altitude"],
            "dangerous": True  # æ ‡è®°ä¸ºå±é™©æ“ä½œ
        },
        # ... å…¶ä»–æ–¹æ³•
    }
    
    def __init__(self, ros_bridge: ROSBridge):
        self.ros = ros_bridge
    
    async def takeoff(self, uav_id: str, altitude: float) -> ToolResult:
        """æ‰§è¡Œèµ·é£"""
        # 1. æ£€æŸ¥å½“å‰çŠ¶æ€
        state = self.ros.get_cached_state(uav_id)
        if state and state.armed and state.altitude > 0:
            return ToolResult.error(f"UAV {uav_id} å·²åœ¨ç©ºä¸­")
        
        # 2. è§£é”
        arm_result = await self.ros.call_arm(uav_id, arm=True)
        if not arm_result.success:
            return ToolResult.error(f"è§£é”å¤±è´¥: {arm_result.message}")
        
        # 3. èµ·é£
        takeoff_result = await self.ros.send_takeoff(uav_id, altitude)
        
        return ToolResult(
            llm_content=[{"type": "text", "text": f"UAV {uav_id} æ­£åœ¨èµ·é£åˆ° {altitude}m"}],
            return_display=f"âœ… {uav_id} èµ·é£ä¸­...",
            metadata={"altitude_target": altitude}
        )
```

---

## ğŸ’¡ Prompt è®¾è®¡æŒ‡å—

### System Prompt ç»“æ„

```python
COORDINATOR_SYSTEM_PROMPT = """
ä½ æ˜¯ UAV Commander çš„ä¸»åè°ƒä»£ç†ï¼Œè´Ÿè´£ç†è§£ç”¨æˆ·çš„æ— äººæœºæ§åˆ¶æ„å›¾å¹¶è°ƒåº¦æ‰§è¡Œã€‚

## è§’è‰²å®šä½
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æ— äººæœºé›†ç¾¤æ§åˆ¶ä¸“å®¶ï¼Œèƒ½å¤Ÿ:
- ç†è§£è‡ªç„¶è¯­è¨€å½¢å¼çš„é£è¡Œä»»åŠ¡æŒ‡ä»¤
- å°†å¤æ‚ä»»åŠ¡åˆ†è§£ä¸ºå¯æ‰§è¡Œçš„å­ä»»åŠ¡
- è°ƒåº¦åˆé€‚çš„ä¸“ä¸šå­ä»£ç†å®Œæˆä»»åŠ¡
- ç›‘æ§ä»»åŠ¡æ‰§è¡ŒçŠ¶æ€å¹¶å‘ç”¨æˆ·æŠ¥å‘Š

## å¯ç”¨å·¥å…·

### å­ä»£ç†å·¥å…·
1. `formation_agent` - ç¼–é˜Ÿæ§åˆ¶ä¸“å®¶
   - ç”¨äº: å»ºç«‹/å˜æ¢ç¼–é˜Ÿã€ç¼–é˜Ÿé£è¡Œ
   - å‚æ•°: formation_type, target, uav_ids

2. `navigation_agent` - å¯¼èˆªè§„åˆ’ä¸“å®¶  
   - ç”¨äº: è·¯å¾„è§„åˆ’ã€èˆªç‚¹é£è¡Œã€é¿éšœ
   - å‚æ•°: waypoints, constraints

3. `search_agent` - æœç´¢ä»»åŠ¡ä¸“å®¶
   - ç”¨äº: åŒºåŸŸæœç´¢ã€ç›®æ ‡è¯†åˆ«
   - å‚æ•°: search_area, pattern, target_type

### ç›´æ¥æ§åˆ¶å·¥å…·
1. `device_tool` - å•æœºæ§åˆ¶
   - takeoff, land, goto, arm, disarm, get_status

2. `swarm_tool` - é›†ç¾¤æ§åˆ¶
   - form_formation, disperse, sync_action

3. `safety_tool` - å®‰å…¨æ§åˆ¶
   - emergency_stop, check_geofence, get_battery_status

## å®‰å…¨å‡†åˆ™
1. èµ·é£å‰å¿…é¡»ç¡®è®¤æ‰€æœ‰æ— äººæœºçŠ¶æ€æ­£å¸¸
2. å±é™©æ“ä½œä¼šè¯·æ±‚ç”¨æˆ·ç¡®è®¤ï¼Œè¯·åœ¨è¾“å‡ºä¸­è¯´æ˜
3. é‡åˆ°å¼‚å¸¸ç«‹å³ä½¿ç”¨ emergency_stop
4. å§‹ç»ˆç›‘æ§ç”µé‡ï¼Œä½äº 20% æ—¶æé†’è¿”èˆª

## è¾“å‡ºè§„èŒƒ
- æ‰§è¡Œæ“ä½œå‰ç®€è¦è¯´æ˜è®¡åˆ’
- è°ƒç”¨å·¥å…·åæŠ¥å‘Šæ‰§è¡ŒçŠ¶æ€
- ä»»åŠ¡å®Œæˆåæ€»ç»“ç»“æœ
- é‡åˆ°é—®é¢˜æ—¶æ¸…æ™°è¯´æ˜åŸå› å’Œå»ºè®®

## ç¤ºä¾‹å¯¹è¯

ç”¨æˆ·: è®©3æ¶æ— äººæœºèµ·é£å¹¶é£åˆ°æ“åœºä¸­å¿ƒ
åŠ©æ‰‹: å¥½çš„ï¼Œæˆ‘å°†æ‰§è¡Œä»¥ä¸‹æ­¥éª¤:
1. æ£€æŸ¥ 3 æ¶æ— äººæœºçŠ¶æ€
2. ä¾æ¬¡èµ·é£åˆ°å®‰å…¨é«˜åº¦
3. ç¼–é˜Ÿé£å¾€æ“åœºä¸­å¿ƒ

é¦–å…ˆæ£€æŸ¥æ— äººæœºçŠ¶æ€...
[è°ƒç”¨ device_tool.get_status for uav_1, uav_2, uav_3]
"""
```

---

## ğŸš€ å¼€å‘è·¯çº¿å›¾

### Phase 1: åŸºç¡€æ¡†æ¶ (MVP) - 4å‘¨

- [ ] **æ ¸å¿ƒ Agent ç³»ç»Ÿ**
  - [ ] AgentExecutor ä¸»å¾ªç¯å®ç°
  - [ ] CoreToolScheduler å·¥å…·è°ƒåº¦
  - [ ] Task çŠ¶æ€æœºä¸äº‹ä»¶å‘å¸ƒ
  - [ ] SubagentInvocation å­ä»£ç†å®¹å™¨

- [ ] **LLM é›†æˆ**
  - [ ] BaseLLM æŠ½è±¡æ¥å£
  - [ ] OpenAI / Claude å®¢æˆ·ç«¯å®ç°
  - [ ] æµå¼è¾“å‡ºæ”¯æŒ
  - [ ] Function Calling å¤„ç†

- [ ] **åŸºç¡€å·¥å…·**
  - [ ] DeviceTool (takeoff, land, goto)
  - [ ] ToolRegistry å·¥å…·æ³¨å†Œ

- [ ] **CLI ç•Œé¢**
  - [ ] äº¤äº’å¼ REPL
  - [ ] å·¥å…·ç¡®è®¤å¯¹è¯æ¡†

### Phase 2: ROS é›†æˆä¸é›†ç¾¤èƒ½åŠ› - 4å‘¨

- [ ] **ROS 2 Bridge**
  - [ ] Topics è®¢é˜… (çŠ¶æ€åŒæ­¥)
  - [ ] Services è°ƒç”¨ (å³æ—¶æŒ‡ä»¤)
  - [ ] Actions å®¢æˆ·ç«¯ (é•¿æ—¶ä»»åŠ¡)

- [ ] **é›†ç¾¤æ§åˆ¶**
  - [ ] SwarmTool å®ç°
  - [ ] ç¼–é˜Ÿç®—æ³•é›†æˆ
  - [ ] å¤šæœºååŒé€»è¾‘

- [ ] **Multi-Agent**
  - [ ] AgentRegistry å®ç°
  - [ ] Formation Agent
  - [ ] Navigation Agent

### Phase 3: å®‰å…¨ä¸å¯é æ€§ - 3å‘¨

- [ ] **å®‰å…¨æœºåˆ¶**
  - [ ] ApprovalMode ä¸‰çº§å®¡æ‰¹
  - [ ] ParameterGuard å‚æ•°æ ¡éªŒ
  - [ ] GeofenceGuard åœ°ç†å›´æ 
  - [ ] EmergencyStop ç´§æ€¥ä¸­æ–­

- [ ] **å¯é æ€§**
  - [ ] LLM æ•…éšœè½¬ç§»
  - [ ] ROS æ–­è¿é‡è¿
  - [ ] ä»»åŠ¡çŠ¶æ€æŒä¹…åŒ–

- [ ] **æ—¥å¿—ä¸å®¡è®¡**
  - [ ] ç»“æ„åŒ–æ—¥å¿—
  - [ ] æ“ä½œå®¡è®¡è¿½è¸ª
  - [ ] ä»»åŠ¡å›æ”¾

### Phase 4: é«˜çº§åŠŸèƒ½ - 4å‘¨

- [ ] **æ™ºèƒ½è§„åˆ’**
  - [ ] Search Agent
  - [ ] è‡ªé€‚åº”ä»»åŠ¡åˆ†é…
  - [ ] å¼‚å¸¸è‡ªåŠ¨æ¢å¤

- [ ] **æ‰©å±•èƒ½åŠ›**
  - [ ] å¤šæ¨¡æ€è¾“å…¥ (è¯­éŸ³)
  - [ ] åœ°å›¾å¯è§†åŒ– GUI
  - [ ] MCP æœåŠ¡å™¨æ”¯æŒ

---

## ğŸ“š æŠ€æœ¯å‚è€ƒ

| æŠ€æœ¯ | ç”¨é€” | å‚è€ƒ |
|------|------|------|
| **Google Gemini CLI** | Agent æ¡†æ¶è®¾è®¡å‚è€ƒ | [gemini-cli](https://github.com/anthropics/anthropic-tools) |
| **A2A Protocol** | Agent-to-Agent é€šä¿¡ | [a2a-js/sdk](https://github.com/anthropics/a2a-js) |
| **PX4 Autopilot** | æ— äººæœºé£æ§ | [px4.io](https://px4.io/) |
| **ROS 2** | æœºå™¨äººé€šä¿¡ä¸­é—´ä»¶ | [docs.ros.org](https://docs.ros.org/) |
| **MAVSDK** | MAVLink SDK | [mavsdk.mavlink.io](https://mavsdk.mavlink.io/) |

---

## ğŸ“„ è®¸å¯è¯

[å¾…å®š]

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

[å¾…å®š]

---

> âš ï¸ **å®‰å…¨å£°æ˜**  
> æœ¬ç³»ç»Ÿæ¶‰åŠæ— äººæœºå®é™…æ§åˆ¶ï¼Œå¯èƒ½é€ æˆäººèº«ä¼¤å®³å’Œè´¢äº§æŸå¤±ã€‚è¯·åœ¨åˆæ³•åˆè§„çš„å‰æä¸‹ä½¿ç”¨ï¼Œç¡®ä¿ï¼š
> - å…·å¤‡å¿…è¦çš„é£è¡Œèµ„è´¨å’Œè®¸å¯
> - åœ¨å®‰å…¨çš„ç©ºåŸŸå’Œç¯å¢ƒä¸­æ“ä½œ
> - é¦–æ¬¡ä½¿ç”¨åœ¨ä»¿çœŸç¯å¢ƒä¸­å……åˆ†æµ‹è¯•
> - å§‹ç»ˆä¿æŒäººå·¥ç›‘ç£å’Œç´§æ€¥ä¸­æ–­èƒ½åŠ›
